{% extends 'KrevindiouBagheeraBundle::base.html.twig' %}

{% block page_title 'operation_list_page_title'|trans %}

{% block main_actions %}
    <div class="btn-group">
        <a href="{{ path('operation_new', {'accountId': account.accountId}) }}" class="btn{{ tipNewOperation ? ' tip' : '' }}"{% if tipNewOperation %} title="{{ "tip_new_operation"|trans }}"{% endif %}><i class="icon-plus-sign"></i> {{ 'operation_new_link'|trans }}</a>
        <a href="{{ path('operation_search_form', {'accountId': account.accountId}) }}" class="btn search"><i class="icon-search"></i> {{ 'operation_search_link'|trans }}</a>
        <a href="{{ path('scheduler_list', {'accountId': account.accountId}) }}" class="btn"><i class="icon-time"></i> {{ 'scheduler_list'|trans }}</a>
    </div>
{% endblock %}

{% block breadcrumb %}
    <li class="active">{{ account.bank.name }} - {{ account.name }}</li>
{% endblock %}

{% block content %}
<div id="synthesis" class="row">
    <div class="span5">
        <div class="well">
            <figure>
                <figcaption>{{ 'report_synthesis'|trans }}</figcaption>
                <div class="graph"></div>
            </figure>
        </div>
    </div>
    <div class="span7">
        <div id="account-box" class="alert alert-info">
            <h2><i class="icon-paper-clip"></i> {{ account.getBank().getName() }} - {{ account.getName() }}</h2>

            <ul>
                <li>{{ 'balance'|trans }}: <strong class="{{ balance < 0 ? 'negative' : 'positive' }}"> {{ balance|abs|money(account.currency) }}</strong></li>
                <li>{{ 'reconciled_balance'|trans }}: <strong class="{{ reconciledBalance < 0 ? 'negative' : 'positive' }}">{{ reconciledBalance|abs|money(account.currency) }}</strong></li>
            </ul>
        </div>
    </div>
</div>

{% if operations|length > 0 %}
<form id="operation" {% if displaySearch %}class="with-sidebar" {% endif %}method="post" action="">
    <table class="table table-striped table-bordered table-hover table-condensed">
        <tr>
            <th></th>
            <th></th>
            <th>{{ 'operation_third_party'|trans }}</th>
            <th>{{ 'operation_category'|trans }}</th>
            <th></th>
            <th class="amount">{{ 'operation_amount'|trans }}</th>
            <th class="date">{{ 'operation_value_date'|trans }}</th>
            <th></th>
        </tr>
        {% for operation in operations %}
        <tr>
            <td class="check"><input type="checkbox" name="operationsId[]" value="{{ operation.operationId }}" /></td>
            <td>
                {% if operation.isReconciled %}
                <i class="icon-ok" title="{{ 'operation_is_reconciled'|trans }}"></i>&nbsp;
                {% endif %}

                {% if operation.scheduler is not null %}
                <i class="icon-time" title="{{ 'operation_scheduler'|trans }}"></i>
                {% endif %}
            </td>
            <td>{{ operation.thirdParty }}</td>
            <td>{{ (operation.category is not null) ? operation.category.name : '' }}</td>
            <td class="payment-method">
                <i class="{% spaceless %}
                {% if operation.paymentMethod.name == 'credit_card' %}
                    icon-credit-card
                {% elseif operation.paymentMethod.name == 'check' %}
                    icon-list-alt
                {% elseif operation.paymentMethod.name == 'withdrawal' %}
                    icon-money
                {% elseif operation.paymentMethod.name == 'transfer' %}
                    icon-exchange
                {% elseif operation.paymentMethod.name == 'deposit' %}
                    icon-money
                {% endif %}
                {% endspaceless %}" title="{{ ('payment_method_' ~ operation.paymentMethod.name)|trans }}"></i>
            </td>
            <td class="amount {{ (0 != operation.debit) ? 'debit' : 'credit' }}">
                {{ (0 != operation.debit) ? operation.debit : operation.credit }}
                {% if (0 != operation.debit) %}
                    <i class="icon-arrow-down debit" title="{{ 'operation_type_debit'|trans }}"></i>
                {% else %}
                    <i class="icon-arrow-up credit" title="{{ 'operation_type_credit'|trans }}"></i>
                {% endif %}
            </td>
            <td class="date">{{ operation.valueDate|date('Y-m-d') }}</td>
            <td class="actions"><a href="{{ path('operation_edit', {'operationId': operation.operationId}) }}" class="btn btn-mini" title="{{ 'operation_edit_link'|trans }}"><i class="icon-pencil"></i></a></td>
        </tr>
        {% endfor %}
    </table>

    <div class="btn-group form-actions hide">
        <button type="submit" name="delete" class="btn delete" data-toggle="modal"><i class="icon-trash"></i> {{ 'operation_delete_button'|trans }}</button>
        <button type="submit" name="reconcile" class="btn reconcile" data-toggle="modal"><i class="icon-check"></i> {{ 'operation_reconcile_button'|trans }}</button>
    </div>

    <div class="pagination pagination-right">
    {{ pagerfanta(operations, 'twitter_bootstrap') }}
    </div>
</form>

{{ render(controller("KrevindiouBagheeraBundle:OperationSearch:form", {"account": account, "display": displaySearch})) }}

<script type="text/javascript">
    require(
        ["main"],
        function() {
            require(
                [
                    "jquery_flot",
                    "jquery_flot_time"
                ],
                function() {
                    require(
                        [
                            "/report_synthesis_account_{{ account.accountId }}.js"
                        ],
                        function() {
                        }
                    );
                }
            );
        }
    );
</script>
{% endif %}
{% endblock %}
