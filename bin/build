#!/usr/bin/env bash

project_dir=$(cd "$(dirname "$0")" && cd .. && pwd)

# will let the permissions be 0777
umask 000

if [[ -z $APP_ENV || $APP_ENV = 'dev' ]]; then
    composer --working-dir="$project_dir" install --no-ansi --no-interaction --no-progress
    (cd "$project_dir"; yarn install --production=false; yarn encore dev)
else
    composer --working-dir="$project_dir" install --no-ansi --no-interaction --no-progress --no-dev --optimize-autoloader
    (cd "$project_dir"; yarn install --production=true; yarn encore production)
fi

(cd "$project_dir"; php bin/console doctrine:migrations:migrate --no-interaction)
